{% extends "base.html" %}
{% block title %}Add User{% endblock %}
{% load static %}

{% block content %}
    <li>
        <a href="javascript:window.history.back();" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left backBtn"></i> Back
        </a>
    </li>
{% endblock %}

{% block body_block %}
    <style type="text/css">
        #editschoolForm label.error {
            display: inline-block;
            max-width: 100%;
            margin-bottom: 5px;
            font-weight: bold;
            color: #e82d2d;
            width: 100%;
        }

    button, .btn-primary1 {
    background-color: #ebeff3 !important;
    border-color: #edf1f5 !important;
    font-size: 15px !important;
    border-radius: 35px !important;
}

    </style>

    <!-- Content Wrapper. Contains page content -->



    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1></h1>
                    </div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Home</a></li>
                            <li class="breadcrumb-item active">Edit School</li>
                        </ol>
                    </div>
                </div>
            </div><!-- /.container-fluid -->
        </section>

        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <div class="row">

                    <!-- right column -->
                    <div class="col-md-8" style="margin: 0 auto;">
                        <!-- general form elements disabled -->
                        <div class="card card-primary">
                            <div class="card-header">
                                <h3 class="card-title">Edit School</h3>
                            </div>
                            <!-- /.card-header -->
                            <form role="form" method="post" id="editschoolForm" enctype="multipart/form-data">
                                <div class="card-body">
                                    <div class="card-body">
                                        {% csrf_token %}
                                        <div class="row">
                                            <div class="col-lg-4">
                                                <input type="hidden" name="user_id_pk" id="user_id_pk" value="{{user_id}}">
                  <input type="hidden" name="school_id_pk" id="school_id_pk" value="{{school_id}}">
                                                <div class="form-group">
                                                    <label>School Name <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" name="school_name"
                                                           id="school_name" placeholder="School Name">
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>School Label </label>
                                                    <input type="text" class="form-control" name="school_label"
                                                           id="school_label" placeholder="School Label">
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>IML School Code </label>
                                                    <input type="text" class="form-control" name="iml_school_code"
                                                           id="iml_school_code" placeholder="IML School Code">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>School Address</label>
                                                    <input type="text" class="form-control" name="school_address"
                                                           id="school_address" placeholder="School Address">
                                                </div>
                                            </div>

                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Country <span class="text-danger">*</span></label>
                                                    <select class="form-control" id="country" name="country">
                                                        <option value="" selected="selected">---select---</option>
                                                        {% for country_data in country_data %}
                                                            <option value="{{ country_data.id }}">{{ country_data.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>


                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>State <span class="text-danger">*</span></label>
                                                    <select class="form-control" id="state" name="state">
                                                        <option value="" selected="selected">---select---</option>
                                                        {% for state_data in state_data %}
                                                            <option value="{{ state_data.id }}">{{ state_data.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>City <span class="text-danger">*</span></label>
                                                    <select class="form-control" id="city" name="city">
                                                        <option value="" selected="selected">---select---</option>
                                                        city_data
                                                        {% for city_data in city_data %}
                                                            <option value="{{ city_data.id }}">{{ city_data.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Pincode</label>
                                                    <input type="text" class="form-control" name="pincode" id="pincode"
                                                           placeholder="Pincode">
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Board <span class="text-danger">*</span></label>
                                                    <select class="form-control" id="board" name="board">
                                                        <option value="" selected="selected">---select---</option>
                                                        {% for board_data in board_data %}
                                                            <option value="{{ board_data.id }}">{{ board_data.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Medium <span class="text-danger">*</span></label>
                                                    <select class="form-control" id="medium" name="medium">
                                                        <option value="" selected="selected">---select---</option>
                                                        {% for medium_data in medium_data %}
                                                            <option value="{{ medium_data.id }}">{{ medium_data.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>DISE No</label>
                                                    <input type="text" class="form-control" name="dise_no" id="dise_no"
                                                           placeholder="DISE No">
                                                </div>
                                            </div>

                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label for="customFile">School Logo</label>
                                                    <div class="custom-file">
                                                        <input type="file" class="custom-file-input" name="school_photo"
                                                               id="school_photo">
                                                        <label class="custom-file-label" for="user_photo">Choose
                                                            file</label>
                                                    </div>
                                                    <div class="input-group-append">
                              <span><img src={{school_photo}} width="50" height="50"></span>
                           </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label>About School</label>
                                                    <textarea class="form-control" name="about_school" id="about_school"
                                                              rows="3" placeholder="Address"></textarea>
                                                </div>
                                            </div>

                                        </div>


                                        <fieldset>
                                            <legend>School level Setting</legend>


                                            <div class="row">
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label>Class Label </label>
                                                        <input type="text" class="form-control" name="class_label"
                                                               id="class_label" placeholder="Class Label">
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label>Division Label</label>
                                                        <input type="text" class="form-control" name="disivion_label"
                                                               id="disivion_label" placeholder="Division Label">
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label>Module Manager <span class="text-danger btn-primary1">*</span></label>

                                                        <select class="form-control" id="module_manager" name="module_manager" multiple="multiple">
                          {% for module_manager_data in module_manager_data %}
                        <option value="{{module_manager_data.id}}" {% if module_manager_data.name == module_manager_data.name %} selected="selected"  {% endif %} >{{module_manager_data.name}} </option>
                        {% endfor %}
                        </select>

                                                        
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                               
                                         
                                           
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label>Commision </label>
                                                        <!-- <input type="text" class="form-control" name="module_name" id="module_name" placeholder="Module Name">
                                                         -->
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                   name="exampleRadios" id="exampleRadios1"
                                                                   value="option1" checked>
                                                            <label class="form-check-label" for="exampleRadios1">
                                                                Percentage of transaction
                                                            </label>
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                   name="exampleRadios" id="exampleRadios2"
                                                                   value="option2">
                                                            <label class="form-check-label" for="exampleRadios2">
                                                                Flat charges per transaction
                                                            </label>
                                                        </div>

                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label>Commision Value</label>
                                                        <input type="text" class="form-control" name="commision_value"
                                                               id="commision_value" placeholder="Commision Value">
                                                    </div>
                                                </div>

                                                 <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label>Academic Year</label>

                                                        <div class="row">
                                                            <div class="col">
                                                                <select id="month" class="form-control">
                                                                    <option selected>Month</option>
                                                                    <option value="1">1</option>
                                                                    <option value="1">2</option>
                                                                    <option>3</option>
                                                                    <option>4</option>
                                                                    <option>5</option>
                                                                    <option>6</option>
                                                                    <option>7</option>
                                                                    <option>8</option>
                                                                    <option>9</option>
                                                                    <option>10</option>
                                                                    <option>11</option>
                                                                    <option>12</option>
                                                                </select>


                                                            </div>
                                                            <div class="col">
                                                                <select id="year" class="form-control">
                                                                    <option selected>Year</option>
                                                                    <option>1950</option>
                                                                    <option>1951</option>
                                                                    <option>1952</option>
                                                                    <option>1953</option>
                                                                    <option>1954</option>
                                                                    <option>1955</option>
                                                                    <option>1956</option>
                                                                    <option>1957</option>
                                                                    <option>1958</option>
                                                                    <option>1959</option>
                                                                    <option>1960</option>
                                                                    <option>1961</option>
                                                                    <option>1962</option>
                                                                    <option>1963</option>
                                                                    <option>1964</option>
                                                                    <option>1965</option>
                                                                    <option>1966</option>
                                                                    <option>1967</option>
                                                                    <option>1968</option>
                                                                    <option>1969</option>
                                                                    <option>1970</option>
                                                                    <option>1971</option>
                                                                    <option>1972</option>
                                                                    <option>1972</option>
                                                                    <option>1973</option>
                                                                    <option>1974</option>
                                                                    <option>1975</option>
                                                                    <option>1976</option>
                                                                    <option>1977</option>
                                                                    <option>1978</option>
                                                                    <option>1979</option>
                                                                    <option>1980</option>
                                                                    <option>1981</option>
                                                                    <option>1982</option>
                                                                    <option>1983</option>
                                                                    <option>1984</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                            </div>


                                        </fieldset>

                                        <fieldset>

                                            <legend for="customFile">School Admin Details</legend>


                                            <div class="row">
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label>School Admin Name </label>
                                                        <input type="text" class="form-control" name="school_admin_name"
                                                               id="school_admin_name" placeholder="School Admin Name">
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label>Email Id</label>
                                                        <input type="text" class="form-control" name="email_id"
                                                               id="email_id" placeholder="Email Id">
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label>Mobile Number</label>
                                                        <input type="text" class="form-control"
                                                               name="school_admin_number" id="school_admin_number"
                                                               placeholder="Mobile Number" readonly>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>

                                        <fieldset id="dynamic_field1">
                                            <legend for="customFile">Bank Details</legend>


                                            <div class="row">
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label>Bank Name </label>
                                                        <input type="text" class="form-control" name="bank_name[]"
                                                               id="bank_name" placeholder="Bank Name">
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label>Account No</label>
                                                        <input type="text" class="form-control" name="account_no[]"
                                                               id="account_no" placeholder="Account No">
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label>&nbsp;</label>
                                                    </div>
                                                </div>

                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label>IFSC Code </label>
                                                        <input type="text" class="form-control" name="ifsc_code[]"
                                                               id="ifsc_code" placeholder="IFSC Code">
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label>Branch Name</label>
                                                        <input type="text" class="form-control" name="branch_name[]"
                                                               id="branch_name" placeholder="Branch Name">
                                                    </div>
                                                </div>

                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label>&nbsp;</label><br/>
                                                        <button type="button" class="btn btn-primary" id="add1">Add
                                                            another bank account
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>

                                    </div>

                                    <div class="card-footer">
                                        <button type="submit" style="margin-left: 220px;" class="btn btn-primary">
                                            Submit
                                        </button>


                                    </div>
                                </div>
                            </form>

                            <!-- /.card-body -->
                        </div>

                        <!-- /.card -->

                    </div>
                    <!--/.col (right) -->
                </div>
                <!-- /.row -->
            </div><!-- /.container-fluid -->
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>
    <script type="text/javascript">
        {% autoescape off %}
            var result_data = {{ school_details}};
            var bank_data = {{ bank_details}};
            var school_admin_details_list = {{ school_admin_details_list }};
            console.log(result_data)
            var i=1;
            var index=0;
            $("#school_name").val(result_data[0])
            $("#school_label").val(result_data[1])
            $("#iml_school_code").val(result_data[2])
            $("#school_address").val(result_data[3])
            $("#country").val(result_data[4]);
            $("#state").val(result_data[5])
            $("#city").val(result_data[6])
            $("#pincode").val(result_data[7])
            $("#medium").val(result_data[8])
            $("#dise_no").val(result_data[9])
            $("#about_school").val(result_data[11])
            $("#board").val(result_data[12])
            $("#class_label").val(result_data[13])
            $("#disivion_label").val(result_data[14])
            $("#commision_value").val(result_data[17])
{#            $("#commision_value").val(result_data[16])#}
            $("#school_admin_name").val(school_admin_details_list[1])
            $("#school_admin_number").val(school_admin_details_list[0])
            $("#email_id").val(school_admin_details_list[2])
{#            $("#year").text(result_data[15])#}
            $("#bank_name").val(bank_data[0][0])
            $("#branch_name").val(bank_data[3][0])
            $("#ifsc_code").val(bank_data[1][0])
            $("#account_no").val(bank_data[2][0])
            $("#school_photo").val(result_data[10])
            $.each(bank_data[0], function (i, obj) {
                console.log(i,obj,'------')
$('#dynamic_field1').append('<div id="row'+i+'" class="row" ><div class="col-lg-4"><div class="form-group"><label>Bank Name </label><input type="text" class="form-control" name="bank_name[]" id="bank_name" value='+bank_data[0][i]+' placeholder="Bank Name"></div></div><div class="col-lg-4"><div class="form-group"> <label>Account No</label> <input type="text" class="form-control" name="account_no[]" id="account_no" value='+bank_data[2][i]+' placeholder="Account No"> </div> </div> <div class="col-lg-4"> <div class="form-group"> <label>&nbsp;</label> </div> </div> <div class="col-lg-4"> <div class="form-group"> <label>IFSC Code </label> <input type="text" class="form-control" name="ifsc_code[]" id="ifsc_code"  value='+bank_data[1][i]+' placeholder="IFSC Code"> </div> </div> <div class="col-lg-4"> <div class="form-group"> <label>Branch Name</label> <input type="text" class="form-control" name="branch_name[]" id="branch_name" value='+bank_data[3][i]+'  placeholder="Branch Name"> </div> </div> <div class="col-lg-4"> <div class="form-group"> <label>&nbsp;</label><br/><button type="button" name="remove" id="'+i+'" class="btn btn-danger btn_remove">X</button> </div> </div> </div>');
                    });
$('#row'+0+'').remove();
        {% endautoescape %}


    </script>
<script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>
    <script>

            $(document).on('input', '#ifsc_code', function () {
                var ifsc_code = $('#ifsc_code').val();
                var account_no = $('#account_no').val();
                var school_name = $('#school_name').val();


if (ifsc_code.length === 11)
                {
                    $.ajax({
                        type: 'GET',
                        url: '/school/unique_bank_dtls/',
                        dataType: 'json',
                        data: {"ifsc_code": ifsc_code,"account_no": account_no,"school_name": school_name},
                        success: function (data) {
                            console.log(data)
                            if (data === '1') {

                            }


                        }
                    })
                }
    })

    </script>
{% endblock %}
